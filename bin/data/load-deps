#! /bin/sh -e

if [ -z "$1" ]
then
  echo "usage $0 PKG"
  exit 1
fi

p=$1
base_url="http://localhost:64210/api/v1"
tf="var/tmp/$RANDOM-deps.nq"
mkdir -p $(dirname $tf)

GOPATH=`pwd`/var/go go list -f '{{ join .Deps "\n" }}' $p | while read d
do
  echo "<$p> <imports> <$d>." >> $tf
  echo "<$p> <is> <pkg>." >> $tf
done

curl -s $base_url/write/file/nquad -F NQuadFile=@$tf | jq -r '.result'
rm $tf
